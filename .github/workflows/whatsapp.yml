name: CADIIA WhatsApp Agent

on:
  workflow_dispatch:
  schedule:
    - cron: "*/10 * * * *"  # religa automaticamente a cada 10 min se cair

jobs:
  agente:
    runs-on: ubuntu-latest
    timeout-minutes: 355  # ~6h

    # impede m√∫ltiplas inst√¢ncias simult√¢neas
    concurrency:
      group: cadIIa-whatsapp
      cancel-in-progress: true

    steps:
      - uses: actions/checkout@v4

      - name: Instalar depend√™ncias
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip
          python3 -V
          pip install --upgrade pip
          pip install openai requests

      - name: Iniciar CADIIA (loop cont√≠nuo)
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ZAPI_INSTANCE:  ${{ secrets.ZAPI_INSTANCE }}
          ZAPI_TOKEN:     ${{ secrets.ZAPI_TOKEN }}
          MASTER_PHONE:   ${{ secrets.MASTER_PHONE }}
        run: |
          echo "ü§ñ CADIIA iniciando processamento cont√≠nuo..."
          python3 processar.py
